<script>
    /* === CONFIG ===
       Your published CSV URL:
    */
    const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTQi-z2SLLIg21-uohF1NG58lzZZuPZ6V_wGuQ_g-PTmjvRHcUR3e6PPg4K80i7_Qia_YZkDIJS2eCL/pub?gid=0&single=true&output=csv";

    const tableHead = document.querySelector("#leaderboard thead");
    const tableBody = document.querySelector("#leaderboard tbody");
    const podium = document.getElementById("podium");

    // store previous state for change detection and FLIP
    let previousRowsMap = new Map(); // key: unique id (player), value: rowData array
    let previousOrder = []; // array of player ids in order

    const POLL_MS = 15000; // 15 seconds - change if you'd like

    // ... (Rest of the JavaScript code remains the same) ...
    
    /* -- utility: robust CSV parser (handles quoted fields & commas) -- */
    function parseCSV(text){
      // ... (CSV parser function) ...
    }

    /* -- auto-detect points column index -- */
    function detectPointsColumn(headers, rows){
      // ... (Column detection function) ...
    }

    /* -- CSV fetch with cache busting to ensure fresh values -- */
    async function fetchSheetCSV(){
      const url = SHEET_URL + (SHEET_URL.includes('?') ? '&' : '?') + '_=' + Date.now();
      const resp = await fetch(url, {cache: "no-store"});
      if (!resp.ok) throw new Error("Failed to fetch sheet: " + resp.status);
      const text = await resp.text();
      return parseCSV(text);
    }

    // ... (Rest of the JavaScript functions) ...
    
    /* -- top-level update function -- */
    async function updateLeaderboard(){
      try {
        const csv = await fetchSheetCSV();
        // small guard: if csv empty or only header, render header and empty body
        if (!csv || csv.length === 0){
          tableHead.innerHTML = "<tr><th>No data</th></tr>";
          tableBody.innerHTML = "";
          return;
        }
        processAndRender(csv);
      } catch (err){
        console.error("Failed to update leaderboard:", err);
      }
    }

    // initial load
    updateLeaderboard();

    // poller
    setInterval(updateLeaderboard, POLL_MS);
  </script>
